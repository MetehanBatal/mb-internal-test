for(var cookie_array=document.cookie.split(";"),fbp=0,fbc=0,i=0;i<cookie_array.length;i++)"_fbp"==cookie_array[i].split("=")[0].trim()&&(fbp=cookie_array[i].split("=")[1]),"_fbc"==cookie_array[i].split("=")[0].trim()&&(fbc=cookie_array[i].split("=")[1]);const extractDataForDataLayer=()=>({lpName:checkoutData.cart.landingPageName,paramMB:checkoutData.cart.checkoutPageParams.mb,paramSource:checkoutData.cart.checkoutPageParams.source,paramUTMSource:checkoutData.cart.checkoutPageParams.utm_source,paramLoader:checkoutData.cart.checkoutPageParams.loader,paramLP:checkoutData.cart.checkoutPageParams.lp,paramFlow:checkoutData.cart.checkoutPageParams.flow,primaryVariantId:checkoutData.cart.primaryVariantId,transactionId:checkoutData.sessionId,transactionTotal:checkoutData.cart.localCart.subTotal,_fbp:fbp,_fbc:fbc,cart_total:checkoutData.cart.localCart.total}),sendDLNewPV=e=>{window.dataLayer.push({event:"page_view_custom",...extractDataForDataLayer()})},handleNewPV=e=>{sendDLNewPV(e),console.log("handleNewPV")},sendDLNewCart=e=>{window.dataLayer.push({event:"new_cart",...extractDataForDataLayer()})},handleNewCart=e=>{sendDLNewCart(e),console.log("handleNewCart")},sendDLInitiateCheckout=e=>{window.dataLayer.push({event:"initiate_checkout",...extractDataForDataLayer(e),eventId:e.eventId,eventSourceUrl:e.eventSourceUrl,email:e.email})},handleInitiateCheckout=e=>{sendDLInitiateCheckout(e)},sendDLAcceptedUpsell=e=>{window.dataLayer.push({event:"accepted_upsell",...extractDataForDataLayer(),upsellValue:e.value,upsellPageName:e.upsellPageName,upsellParam1:e.upsellParam1})},handleAcceptedUpsell=e=>{sendDLAcceptedUpsell(e),console.log("handleAcceptedUpsell")},sendDLPurchase=e=>{var a={ecommerce:{purchase:{actionField:{},products:[]}}};a.ecommerce.purchase.actionField.id=checkoutData.sessionId,a.ecommerce.purchase.actionField.affiliation="RTC",a.ecommerce.purchase.actionField.revenue=checkoutData.cart.localCart.state.total,a.ecommerce.purchase.actionField.tax=checkoutData.cart.localCart.state.taxTotal,a.ecommerce.purchase.actionField.shipping=checkoutData.cart.localCart.state.shippingTotal,a.ecommerce.purchase.actionField.coupon="";var t=checkoutData.cart.localCart.state.lineItems;a.ecommerce.purchase.products=t.map(e=>({id:e.variantId,name:e.title,price:e.price,brand:"Miracle Brand",category:"",variant:"",quantity:e.quantity,coupon:""})),window.dataLayer.push({event:"purchase_custom",...extractDataForDataLayer(),uEmail:e.email,uFirstName:e.shippingAddress.first_name,uLastName:e.shippingAddress.last_name,uPhone:e.shippingAddress.phone,uCity:e.shippingAddress.city,uProvince:e.shippingAddress.province,uZip:e.shippingAddress.zip,uCurrency:e.currency,uCountry:e.shippingAddress.country,totalValue:e.totalValue,ecommerce:a.ecommerce,eventId:e.eventId,eventSourceUrl:e.eventSourceUrl})},handlePurchase=e=>{sendDLPurchase(e),console.log("handlePurchase")};window.dataLayer=window.dataLayer||[],window.checkoutReadyCallbacks=window.checkoutReadyCallbacks||[],window.checkoutReadyCallbacks.push(async function(){Checkout.addPixel(e=>{switch(e.eventType){case"page_view":handleNewPV(e);break;case"new_cart":handleNewCart(e);break;case"checkout_started":handleInitiateCheckout(e);break;case"accepted_upsell":handleAcceptedUpsell(e);break;case"checked_out":handlePurchase(e)}})});